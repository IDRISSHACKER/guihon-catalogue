---
- name: Start docker
  service:
    name: "docker"
    state: started

- name: pulling image
  docker_image:
    name: node
    tag: latest
    source: pull

- name: Obtaining project from github
  git: clone=true repo="{{ app_repository }}" dest="~/{{  app_destination  }}"


- name: Show dir
  shell:
    chdir: "~/{{ app_destination }}"
    cmd: ls

- name: install packages
  shell:
    chdir: "~/{{ app_destination }}"
    cmd: "npm install"


- name: start app inside a container
  docker_container:
    name: "{{ container_name }}"
    image: node:18.13.0-alpine
    state: started
    recreate: yes
    exposed_ports:
      - "{{ app_port }}"
    ports:
      - "{{ app_port }}:{{ container_port }}"
    volumes:
      - "~/{{ app_destination }}:/app"

    working_dir: /app
    command: "npm run start:dev"
  register: app_status

- name: show container status
  debug: var=app_status


- name: get container logs
  shell:
    cmd: "docker logs {{ container_name }}"
  register: container_logs

- name: show container status
  debug: var=container_logs
...
